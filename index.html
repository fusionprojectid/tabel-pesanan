<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Formulir Pesanan - Tritunggal Lancar</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
        --brand-dark: #2D2D2D;
        --brand-primary: #F97316; /* orange-600 */
        --brand-secondary: #EA580C; /* orange-700 */
        --brand-light: #FFF7ED; /* orange-50 */
    }
    body { 
      font-family: 'Poppins', sans-serif; 
      background-color: #f8fafc; /* gray-50 */
    }
    .money { font-variant-numeric: tabular-nums; }
    
    .btn-primary { background-color: var(--brand-primary); color: white; transition: background-color 0.2s; }
    .btn-primary:hover { background-color: var(--brand-secondary); }
    .btn-secondary { background-color: #ef4444; color: white; transition: background-color 0.2s; }
    .btn-secondary:hover { background-color: #dc2626; }
    .btn-tertiary { background-color: #4f46e5; color: white; transition: background-color 0.2s; }
    .btn-tertiary:hover { background-color: #4338ca; }

    .tab-btn.active { border-bottom: 3px solid var(--brand-primary); color: var(--brand-dark); font-weight: 600; }
    .header-main { background-color: var(--brand-dark); }
    
    @media print {
        .no-print { display: none; }
        body { padding: 0; margin: 0; background-color: white; }
        main { box-shadow: none !important; border: none !important; margin: 0; padding: 0; }
    }
  </style>
</head>
<body class="flex flex-col min-h-screen p-4 sm:p-6 md:p-8">

    <div class="flex-grow max-w-7xl mx-auto bg-white p-6 rounded-xl shadow-lg w-full">
        <header class="grid grid-cols-3 items-center gap-4 mb-6 no-print">
            <div class="justify-self-start">
                <img src="logo-warna.png" alt="Logo Perusahaan" class="h-20 w-auto" onerror="this.style.display='none'; this.onerror=null;">
            </div>
            <div class="text-center">
                <h1 class="text-2xl sm:text-3xl font-bold" style="color: var(--brand-dark);">Formulir Pesanan</h1>
            </div>
            <div class="justify-self-end text-right" style="color: var(--brand-dark);">
                <p id="live-date" class="text-lg font-semibold"></p>
                <p class="text-sm">Versi Aplikasi 3.1</p>
            </div>
        </header>

        <nav class="border-b border-gray-200 mb-6 no-print">
            <div class="flex space-x-4">
                <button id="tab-form" class="tab-btn py-3 px-4 text-gray-500 hover:text-orange-600 transition-colors duration-200 active">Input Pesanan</button>
                <button id="tab-rekap" class="tab-btn py-3 px-4 text-gray-500 hover:text-orange-600 transition-colors duration-200">Rekapitulasi Hasil</button>
                <button id="tab-kontak" class="tab-btn py-3 px-4 text-gray-500 hover:text-orange-600 transition-colors duration-200">Lokasi & Kontak</button>
            </div>
        </nav>

        <main id="view-form">
            <div class="max-w-xl mx-auto bg-white p-8 rounded-lg shadow-md border">
                <h2 class="text-xl font-bold mb-6" style="color: var(--brand-dark);">Tambah Pesanan Baru</h2>
                <form id="form-input" class="space-y-4">
                    <div>
                        <label for="nama" class="block text-sm font-medium text-gray-700">Nama Pemesan</label>
                        <input type="text" id="nama" class="mt-1 block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm" required/>
                    </div>
                    
                    <div>
                        <label for="barang" class="block text-sm font-medium text-gray-700">Jenis Barang</label>
                        <select id="barang" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                            <option>Kaos</option>
                            <option>Jaket Hoodie</option>
                            <option>Jaket Gunung</option>
                            <option>PDL</option>
                            <option>Topi</option>
                            <option>Gantungan Kunci</option>
                            <option>Bolpoin</option>
                            <option>Block Note</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                      <div id="opsi-tipe-lengan" class="hidden">
                        <label for="tipe-lengan" class="block text-sm font-medium text-gray-700">Tipe Lengan</label>
                        <select id="tipe-lengan" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                          <option value="Pendek">Pendek</option>
                          <option value="Panjang">Panjang</option>
                        </select>
                      </div>
                      <div id="opsi-ukuran" class="hidden">
                        <label for="ukuran" class="block text-sm font-medium text-gray-700">Ukuran</label>
                        <select id="ukuran" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm">
                          <option>S</option><option>M</option><option>L</option><option>XL</option><option>XXL</option><option>XXXL</option>
                        </select>
                      </div>
                    </div>

                    <div>
                        <label for="jumlah" class="block text-sm font-medium text-gray-700">Jumlah Pesanan</label>
                        <input type="number" id="jumlah" min="1" value="1" class="mt-1 block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm" required/>
                    </div>
                    <div class="pt-4 flex justify-end">
                        <button type="submit" class="btn-primary font-bold py-2 px-4 rounded-lg flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            Simpan Pesanan
                        </button>
                    </div>
                </form>
            </div>
            <div class="max-w-xl mx-auto mt-8 p-4 rounded-md" style="background-color: var(--brand-light);">
                <h3 class="font-semibold" style="color: var(--brand-dark);">Aturan & Harga Dasar</h3>
                <ul class="list-disc list-inside text-sm text-gray-700 mt-2 space-y-1">
                  <li>Harga Kaos: <strong>Rp85.000</strong></li>
                  <li class="ml-4">Lengan panjang: <strong>+Rp10.000</strong></li>
                  <li class="ml-4">Ukuran XXL/XXXL: <strong>+Rp10.000</strong></li>
                  <li>Harga Jaket Hoodie: <strong>Rp150.000</strong></li>
                  <li>Harga Jaket Gunung: <strong>Rp250.000</strong></li>
                  <li>Harga Gantungan Kunci, Bolpoin, Block Note: <strong>@Rp8.000</strong></li>
                  <li>Diskon dihitung per nama berdasarkan total pesanan.</li>
                </ul>
            </div>
        </main>

        <main id="view-rekap" style="display: none;">
            
            <div class="overflow-x-auto rounded-lg shadow-md border border-gray-200">
              <table class="w-full text-sm border-collapse">
                <thead class="text-white text-center font-medium">
                  <tr>
                    <th class="header-main p-3">#</th>
                    <th class="header-main p-3">Nama Pemesan</th>
                    <th class="header-main p-3">Barang</th>
                    <th class="header-main p-3">Detail</th>
                    <th class="header-main p-3">Jumlah</th>
                    <th class="header-main p-3">Harga Satuan</th>
                    <th class="header-main p-3">Subtotal</th>
                  </tr>
                </thead>
                <tbody id="tabel-hasil" class="text-gray-700"></tbody>
                <tfoot class="font-bold text-center">
                  <tr class="bg-gray-100">
                    <td colspan="6" class="border p-3 text-right">Grand Total (Sebelum Diskon)</td>
                    <td id="grand-total" class="border p-3 money text-left">Rp0</td>
                  </tr>
                  <tr class="bg-gray-200">
                    <td colspan="6" class="border p-3 text-right">Total Diskon (dari Semua Pesanan)</td>
                    <td id="diskon" class="border p-3 money text-left">Rp0</td>
                  </tr>
                  <tr style="background-color: var(--brand-light);">
                    <td colspan="6" class="border p-3 text-right text-lg" style="color: var(--brand-dark);">Total Akhir Yang Harus Dibayar</td>
                    <td id="total-diskon" class="border p-3 money text-left text-lg" style="color: var(--brand-dark);">Rp0</td>
                  </tr>
                </tfoot>
              </table>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mt-8" id="rekap"></div>

            <div class="mt-8 pt-6 border-t border-gray-200 flex flex-wrap justify-center gap-3 no-print">
                 <button id="cetak" class="btn-tertiary font-bold py-2 px-4 rounded-lg flex items-center transition-colors duration-200"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>Cetak / Simpan PDF</button>
                 <button id="clear" class="btn-secondary font-bold py-2 px-4 rounded-lg flex items-center transition-colors duration-200"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>Kosongkan Data</button>
            </div>
        </main>

        <main id="view-kontak" style="display: none;">
             <div class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-md border">
                    <h2 class="text-xl font-bold mb-4" style="color: var(--brand-dark);">Lokasi Workshop & Kontak Kami</h2>
                    <div class="space-y-6 text-gray-700">
                        <div>
                            <h3 class="font-bold text-lg mb-2" style="color: var(--brand-dark);">Pusat (Wendit)</h3>
                            <div class="flex items-start mb-2">
                                <svg class="w-5 h-5 mr-3 mt-1 flex-shrink-0" style="color: var(--brand-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                                <p>Jl. Simpang Anggodo, Lowoksuruh No. 38, RT.05/RW.09, Mangliawan, Pakis, Malang</p>
                            </div>
                            <div class="flex items-start mb-2">
                                <svg class="w-5 h-5 mr-3 mt-1 flex-shrink-0" style="color: var(--brand-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                                <a href="tel:+6281333418777" class="hover:underline">+62 813-3341-8777</a>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg mb-2" style="color: var(--brand-dark);">Cabang (Mangliawan)</h3>
                             <div class="flex items-start mb-2">
                                <svg class="w-5 h-5 mr-3 mt-1 flex-shrink-0" style="color: var(--brand-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                                <p>Cokro, Sukoanyar, Kec. Pakis, Kabupaten Malang, Jawa Timur 65154</p>
                            </div>
                             <div class="flex items-start mb-2">
                                <svg class="w-5 h-5 mr-3 mt-1 flex-shrink-0" style="color: var(--brand-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                                <a href="tel:+6281335359499" class="hover:underline">+62 813-3535-9499</a>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg mb-2" style="color: var(--brand-dark);">Cabang (Kota Batu)</h3>
                             <div class="flex items-start mb-2">
                                <svg class="w-5 h-5 mr-3 mt-1 flex-shrink-0" style="color: var(--brand-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                                <p>Wukir VI A No.23, Temas, Kec. Batu, Kota Batu, Jawa Timur 65315</p>
                            </div>
                            <div class="flex items-start mb-2">
                                <svg class="w-5 h-5 mr-3 mt-1 flex-shrink-0" style="color: var(--brand-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                                <a href="tel:+6281333418777" class="hover:underline">+62 813-3341-8777</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="rounded-lg shadow-md overflow-hidden">
                    <iframe src="http://googleusercontent.com/maps.google.com/6" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
            </div>
        </main>
    </div>

    <footer class="no-print mt-auto text-white mt-12" style="background-color: #2D2D2D;">
        <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-8 text-sm p-8">
            <div class="md:col-span-1">
                <img src="logo-bw.png" alt="Logo Tritunggal Lancar" class="h-20 w-auto mb-4" onerror="this.style.display='none'; this.onerror=null;">
                <p class="text-gray-300">
                    Tritunggal Lancar (TTL) adalah pusat sablon kaos grosir dan eceran, selain itu kami juga mengerjakan sablon lain seperti tas, buku, dan marchendise lain.
                </p>
            </div>
            <div>
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path></svg>
                    ALAMAT
                </h3>
                <div class="space-y-4">
                   <p class="text-gray-300">
                       <strong class="block text-white">Pusat (Wendit):</strong>
                       Jl. Simpang Anggodo, Lowoksuruh No. 38, RT.05/RW.09, Mangliawan, Pakis, Malang
                   </p>
                   <p class="text-gray-300">
                       <strong class="block text-white">Cabang (Mangliawan):</strong>
                       Cokro, Sukoanyar, Kec. Pakis, Kab. Malang
                   </p>
                   <p class="text-gray-300">
                       <strong class="block text-white">Cabang (Kota Batu):</strong>
                       Wukir VI A No.23, Temas, Kec. Batu, Kota Batu
                   </p>
                </div>
            </div>
            <div>
                 <h3 class="font-bold text-lg mb-4 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path></svg>
                    WHATSAPP
                </h3>
                <a href="https://wa.me/6281333418777" target="_blank" class="text-gray-300 hover:text-white">+62 813-3341-8777</a>
    
                 <h3 class="font-bold text-lg mb-4 mt-6 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                    EMAIL
                </h3>
                <a href="mailto:kustomofamily@gmail.com" class="text-gray-300 hover:text-white">kustomofamily@gmail.com</a>
            </div>
            <div class="flex justify-start md:justify-end items-start space-x-4 mt-4 md:mt-0">
                 <a href="https://www.instagram.com/ttl_workshop" target="_blank" class="text-gray-300 hover:text-white">
                     <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.024.06 1.378.06 3.808s-.012 2.784-.06 3.808c-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.024.048-1.378.06-3.808.06s-2.784-.012-3.808-.06c-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.048-1.024-.06-1.378-.06-3.808s.012-2.784.06-3.808c.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 016.08 2.525c.636-.247 1.363.416 2.427-.465C9.53 2.013 9.884 2 12.315 2zM12 0C9.81 0 9.43.01 8.35.057c-1.12.05-1.9.223-2.59.484a6.897 6.897 0 00-2.33 1.62A6.897 6.897 0 001.81 6.35c-.26.69-.434 1.47-.484 2.59C1.272 9.43 1.262 9.81 1.262 12s.01 2.57.057 3.65c.05 1.12.223 1.9.484 2.59a6.897 6.897 0 001.62 2.33 6.897 6.897 0 002.33 1.62c.69.26 1.47.434 2.59.484C9.43 22.728 9.81 22.738 12 22.738s2.57-.01 3.65-.057c1.12-.05 1.9-.223 2.59-.484a6.897 6.897 0 002.33-1.62 6.897 6.897 0 001.62-2.33c.26-.69.434-1.47.484-2.59.048-1.08.057-1.46.057-3.65s-.01-2.57-.057-3.65c-.05-1.12-.223-1.9-.484-2.59a6.897 6.897 0 00-1.62-2.33A6.897 6.897 0 0018.19.54c-.69-.26-1.47-.434-2.59-.484C14.57.01 14.19 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.88 1.44 1.44 0 000-2.88z" clip-rule="evenodd"></path></svg>
                 </a>
                 <a href="https://www.facebook.com/share/1CqqabnUeD/" target="_blank" class="text-gray-300 hover:text-white">
                     <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" clip-rule="evenodd"></path></svg>
                 </a>
            </div>
        </div>
        <div class="py-4 text-center text-sm text-gray-300" style="background-color: var(--brand-dark);">
            <p>Copyright © 2025 Tritunggal Lancar | Powered by ArkIntelligent</p>
        </div>
    </footer>


<script>
// KONSTANTA & DATA HARGA
const HARGA_BARANG = {
    'Kaos': 85000,
    'Jaket Hoodie': 150000,
    'Jaket Gunung': 250000,
    'Gantungan Kunci': 8000,
    'Bolpoin': 8000,
    'Block Note': 8000,
    'PDL': 185000, // Harga asumsi
    'Topi': 45000,   // Harga asumsi
};
const BARANG_PAKAI_UKURAN = ['Kaos', 'Jaket Hoodie', 'Jaket Gunung', 'PDL', 'Topi'];
const UKURAN_BIAYA_TAMBAHAN = ['XXL', 'XXXL'];
const BIAYA_TAMBAHAN = 10000;

// FUNGSI HELPER
function formatRupiah(n) { return "Rp" + new Intl.NumberFormat("id-ID").format(n); }
function getPesanan() { return JSON.parse(localStorage.getItem("pesananKaos") || "[]"); }
function setPesanan(data) { localStorage.setItem("pesananKaos", JSON.stringify(data)); }
function formatTanggal(date) { return date.toLocaleString("id-ID", { year: "numeric", month: "2-digit", day: "2-digit", hour: "2-digit", minute: "2-digit" }); }

function hitungHargaSatuan(item) {
    let harga = HARGA_BARANG[item.barang] || 0;
    // Hanya Kaos yang punya aturan biaya tambahan
    if (item.barang === 'Kaos') {
        if (item.tipeLengan === 'Panjang') {
            harga += BIAYA_TAMBAHAN;
        }
        if (UKURAN_BIAYA_TAMBAHAN.includes(item.ukuran)) {
            harga += BIAYA_TAMBAHAN;
        }
    }
    return harga;
}

function hitungDiskon(jumlah) {
  if (jumlah >= 500) return 0.5;
  if (jumlah >= 100) return 0.25;
  if (jumlah >= 50) return 0.1;
  return 0;
}

// FUNGSI RENDER TABEL DAN REKAP
function renderHasil() {
  const pesanan = getPesanan();
  const tbody = document.getElementById("tabel-hasil");
  tbody.innerHTML = "";

  const grup = {};
  pesanan.forEach(p => {
    const key = p.nama.toLowerCase();
    if (!grup[key]) grup[key] = [];
    grup[key].push(p);
  });

  let grandTotalSebelumDiskon = 0, grandTotalDiskon = 0, grandTotalSetelahDiskon = 0;
  let jumlahTotalPcs = 0;
  let i = 1;

  Object.values(grup).forEach(group => {
    let totalPerNama = 0, jumlahPerNama = 0;

    // Render setiap item dalam grup
    group.forEach((p, idx) => {
      const hargaSatuan = hitungHargaSatuan(p);
      const subtotal = hargaSatuan * p.jumlah;
      totalPerNama += subtotal;
      jumlahPerNama += p.jumlah;
      jumlahTotalPcs += p.jumlah;

      let detail = p.ukuran || '';
      if (p.barang === 'Kaos' && p.tipeLengan) {
          detail = `${p.tipeLengan}, ${p.ukuran}`;
      }

      const tr = document.createElement("tr");
      tr.className = "hover:bg-gray-50 text-center";
      tr.innerHTML = `
        <td class="border p-2 text-xs">${i++}</td>
        ${idx === 0 ? `<td class="border p-2 font-semibold text-left align-top" rowspan="${group.length + 1}">${p.nama}</td>` : ""}
        <td class="border p-2 text-left">${p.barang}</td>
        <td class="border p-2">${detail || '-'}</td>
        <td class="border p-2">${p.jumlah}</td>
        <td class="border p-2 money text-right">${formatRupiah(hargaSatuan)}</td>
        <td class="border p-2 money text-right">${formatRupiah(subtotal)}</td>
      `;
      tbody.appendChild(tr);
    });

    const diskonRateNama = hitungDiskon(jumlahPerNama);
    const diskonNama = totalPerNama * diskonRateNama;
    const totalNamaSetelahDiskon = totalPerNama - diskonNama;
    
    grandTotalSebelumDiskon += totalPerNama;
    grandTotalDiskon += diskonNama;
    grandTotalSetelahDiskon += totalNamaSetelahDiskon;

    const trTotal = document.createElement("tr");
    trTotal.className = "font-semibold";
    trTotal.style.backgroundColor = 'var(--brand-light)';
    trTotal.innerHTML = `
      <td colspan="4" class="border p-2 text-right text-sm" style="color: var(--brand-dark);">
        Total untuk ${group[0].nama} (${jumlahPerNama} pcs)
      </td>
      <td class="border p-2 text-center text-sm" style="color: var(--brand-secondary);">
        Diskon: ${diskonRateNama * 100}%
      </td>
      <td class="border p-2 money text-right text-sm" style="color: var(--brand-dark);">
        ${formatRupiah(totalNamaSetelahDiskon)}
      </td>
    `;
    tbody.appendChild(trTotal);
  });
  
  document.getElementById("grand-total").textContent = formatRupiah(grandTotalSebelumDiskon);
  document.getElementById("diskon").textContent = `- ${formatRupiah(grandTotalDiskon)}`;
  document.getElementById("total-diskon").textContent = formatRupiah(grandTotalSetelahDiskon);

  document.getElementById("rekap").innerHTML = `
    <div class="bg-white p-6 rounded-lg shadow-md border-t-4" style="border-color: var(--brand-dark);">
        <h3 class="font-semibold text-gray-600">Total Item Dipesan</h3>
        <p class="text-3xl font-bold mt-1" style="color: var(--brand-dark);">${jumlahTotalPcs}</p>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md border-t-4" style="border-color: var(--brand-secondary);">
        <h3 class="font-semibold text-gray-600">Total Sebelum Diskon</h3>
        <p class="text-3xl font-bold mt-1" style="color: var(--brand-dark);">${formatRupiah(grandTotalSebelumDiskon)}</p>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-red-500">
        <h3 class="font-semibold text-gray-600">Total Penghematan</h3>
        <p class="text-3xl font-bold mt-1" style="color: var(--brand-dark);">${formatRupiah(grandTotalDiskon)}</p>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-green-500">
        <h3 class="font-semibold text-gray-600">Total Tagihan Akhir</h3>
        <p class="text-3xl font-bold mt-1" style="color: var(--brand-dark);">${formatRupiah(grandTotalSetelahDiskon)}</p>
    </div>`;
}

// EVENT LISTENER
document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('live-date').textContent = new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

    const tabs = document.querySelectorAll('.tab-btn');
    const views = document.querySelectorAll('main');
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            views.forEach(view => view.style.display = 'none');
            const targetView = document.getElementById(tab.id.replace('tab-', 'view-'));
            if(targetView) targetView.style.display = 'block';
            if(tab.id === 'tab-rekap') renderHasil();
        });
    });

    const barangSelect = document.getElementById("barang");
    const opsiTipeLengan = document.getElementById("opsi-tipe-lengan");
    const opsiUkuran = document.getElementById("opsi-ukuran");

    function toggleFormOptions() {
        const selectedBarang = barangSelect.value;
        opsiTipeLengan.classList.toggle('hidden', selectedBarang !== 'Kaos');
        opsiUkuran.classList.toggle('hidden', !BARANG_PAKAI_UKURAN.includes(selectedBarang));
    }
    barangSelect.addEventListener('change', toggleFormOptions);
    toggleFormOptions(); // Initial call

    document.getElementById("form-input").addEventListener("submit", e => {
      e.preventDefault();
      const pesanan = getPesanan();
      const newItem = {
          nama: document.getElementById("nama").value.trim(),
          barang: document.getElementById("barang").value,
          tipeLengan: document.getElementById("tipe-lengan").value,
          ukuran: document.getElementById("ukuran").value,
          jumlah: parseInt(document.getElementById("jumlah").value) || 1,
          tanggal: formatTanggal(new Date())
      };

      // Buat kunci unik untuk item yang sama, abaikan jika tidak ada ukuran/tipe
      const keyGenerator = (item) => [
          item.nama.toLowerCase(),
          item.barang,
          BARANG_PAKAI_UKURAN.includes(item.barang) ? item.ukuran : 'no-size',
          item.barang === 'Kaos' ? item.tipeLengan : 'no-sleeve'
      ].join('-');

      const newItemKey = keyGenerator(newItem);
      const existingIndex = pesanan.findIndex(p => keyGenerator(p) === newItemKey);

      if (existingIndex > -1) {
        pesanan[existingIndex].jumlah += newItem.jumlah;
        pesanan[existingIndex].tanggal = newItem.tanggal;
        alert("Jumlah pesanan untuk item yang sama berhasil diperbarui!");
      } else {
        pesanan.push(newItem);
        alert("Pesanan baru berhasil ditambahkan!");
      }
      
      setPesanan(pesanan);
      e.target.reset();
      toggleFormOptions();
      document.getElementById("nama").focus();
    });

    document.getElementById("cetak").addEventListener("click", () => window.print());
    document.getElementById("clear").addEventListener("click", () => {
      if (confirm("Anda yakin ingin mengosongkan seluruh data pesanan?")) {
        setPesanan([]); 
        renderHasil();
      }
    });
});
</script>
</body>
</html>
